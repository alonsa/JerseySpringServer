<html>

<head>

    <style>
        form {
            margin: 0;
            padding: 0;
        }

        .content {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .video-container {
            height: 100%;
        }

        #video-frame {
            width: 100%;
            height: 100%;
        }

        .btns-location {
            position: absolute;
            bottom: 50px;
            width: 100%;
        }

        .btns-container {
            text-align: center;
            display: flex;
            justify-content : space-around;
        }

        .actions-buttons {
            width: 300px;
            height: 90px;
            text-align: left;
        }

        .movie-body {
            display: flex;
            justify-content : space-around;
            background-color: rgba(0, 0, 0, 0.73);
            color: white;
            font-size: 90%;
            padding: 5px 0;

        }

        .movie-body-text {
            display: flex;
            flex-direction: column;
        }

        .button-header {
            color: white;
            text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
            font-weight: bold;
            font-size: 110%;
        }

        .movie-body-action-area{
            display: flex;

            justify-content : flex-end;
            align-items : flex-end;
        }

        .change-button {
            display: flex;

            justify-content : flex-end;
            align-items : flex-end;
        }

        .up-down {
            display: flex;
            flex-direction: column;

        }
        .up-down-button{
            margin: 0;
            padding: 0;
            border: 0;
        }

        hr{
            border-width: 5px;
            color: #8b282b;
            border-color: #8b282b;
            background-color: #8b282b;
            margin-bottom: auto;
        }

        .play-img {
            width: 40px;
            height: 40px;
        }

    </style>
</head>


<body>

<div class="content">
    <div class="video-container">
        <iframe id="video-frame"
                >
            <!--src="http://www.youtube.com/embed/XGSy3_Czz8k?autoplay=1">-->
        </iframe>
    </div>

    <div class="btns-location">
        <div class="btns-container">

            <div class="actions-buttons">
                <div class=button-header>&nbsp&nbsp&nbsp Now Playing:</div>
                <hr>
                <div class="movie-body" >
                    <div class="movie-body-text" >
                        <div id="first-movie-title" >First Movie Title</div>
                        <div class="first-movie-plot" >First Movie Plot</div>
                    </div>
                    <div class="movie-body-action-area" >
                        <div id="timer" >Ends in: </div>
                    </div>
                    <!--<div class="element" id="el5"><b>element 5</b> <span class="timeout">10000</span> seconds</div>-->

                </div>

            </div>

            <div class="actions-buttons">
                <div class=button-header>&nbsp&nbsp&nbsp Next pic:</div>

                <hr>

                <div class="movie-body" >
                    <div class="movie-body-text" >
                        <div id="second-movie-title" >Second Movie Title</div>
                        <div class="first-movie-plot" >Second Movie Plot</div>
                    </div>

                    <div class = "up-down">
                        <button class="up-down-button" type="submit" style="background-color:transparent; border-color:transparent;">
                            <img src="http://www.clker.com/cliparts/c/9/1/c/124568764843218829Soeb_Plain_Arrow_4.svg.med.png" height="20" onclick=upArrow(); border="0"/>
                        </button>
                        <button class="up-down-button" type="submit" style="background-color:transparent; border-color:transparent;">
                            <img src="http://www.clker.com/cliparts/9/1/e/7/1245687669879828181Soeb_Plain_Arrow_5.svg.med.png" height="20" onclick=downArrow(); />
                        </button>
                    </div>

                    <div class = "change-button">
                        <button  id="changed-button" onclick=changedButtonLogic() type="submit" style="background-color:transparent; border-color:transparent;">
                            <img id = "button-image" src="http://www.clker.com/cliparts/e/5/a/2/1206570547560908424akiross_Audio_Button_Set_4.svg.med.png" height="40" onclick=upArrow(); border="0"/>
                        </button>
                    </div>

                    <div class="movie-body-action-area" >
                        <!--<input id="reload" type="button" onclick="location.href='http://google.com';" value="Go to Google" />-->
                        <form action="videoPlayer.html?">
                            <input type="hidden" id= userId name="userName" value="" />
                            <input type="hidden" id= play name="play" value="" />
                            <!--<input type="submit" value="Go away..." />;-->

                            <input type="image" src="http://www.clker.com/cliparts/e/5/a/2/1206570547560908424akiross_Audio_Button_Set_4.svg.med.png" alt="Submit" class="play-img">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script>
    var url = "http://localhost:8090/recommend/epgs/";
    var user;
    var youTubeUrl;
    var nextPlay;
    var buttonState = "play";

    var qs = (function(a) {
        if (a == "") return {};
        var b = {};
        for (var i = 0; i < a.length; ++i)
        {
            var p=a[i].split('=', 2);
            if (p.length == 1)
                b[p[0]] = "";
            else
                b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
        }
        return b;
    })(window.location.search.substr(1).split('&'));

    var xmlhttp = new XMLHttpRequest();

    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var myArr = JSON.parse(xmlhttp.responseText);
            parseGerRecommandationResponse(myArr);
        }
    };

    var  parsedUrl = url + qs["userName"] + "?play=" + qs["play"];
    xmlhttp.open("GET", parsedUrl, true);
    xmlhttp.overrideMimeType('text/xml'); // unsupported by IE

    xmlhttp.send();

    function parseGerRecommandationResponse(arr) {
        var out = "";
        var i;
        for(i = 0; i < arr.length; i++) {
            out += '<a href="' + arr[i].uri + '">' + arr[i].uri + '</a><br>';
        }

        var firstElement = arr[0];
        document.getElementById("first-movie-title").innerHTML = firstElement.title;
        var sec = firstElement.length / 1000;
        var minutes = formatNum(Math.floor(sec / 60));
        var seconds = formatNum(Math.floor(sec % 60));
        document.getElementById("timer").innerHTML = "Ends in: " + minutes + ":" + seconds;
        youTubeUrl = firstElement.uri;

        var secondElement = arr[1];
        document.getElementById('second-movie-title').innerHTML = secondElement.title;
        nextPlay = secondElement.id;
        localStorage.setItem("play", secondElement.id);


        localStorage.setItem("youTubeUrl", youTubeUrl);
        localStorage.setItem("nextPlay", nextPlay);
        localStorage.setItem("user", user);

        document.getElementById('video-frame').src = "https://" + youTubeUrl;

        document.getElementById('play').value = nextPlay;

        function setTimer (sec) {

            var minutes = formatNum(Math.floor(sec / 60));
            var seconds = formatNum(Math.floor(sec % 60));

            document.getElementById("timer").innerHTML = "Ends in: " + minutes + ":" + seconds;
        }

        function inter(sec) {

            setTimeout( function () {
                setTimer (sec);

                if (sec > 0) {
                    inter(sec - 1);
                }else{
                    window.location.href = getRefreshPage();
                }

            }, 1000);
        }

        inter(sec);

    }

    function getRefreshPage() {
        return location.protocol + '//' + location.host + location.pathname + "?userName=" + user + "&play=" + nextPlay;
    }

    function formatNum(input){
        if(input < 10){
            return "0" + input;
        }else {
            return input;
        }
    }

    function upArrow () {
        buttonState = "play";
        document.getElementById('button-image').src = "http://www.clker.com/cliparts/e/5/a/2/1206570547560908424akiross_Audio_Button_Set_4.svg.med.png";
    }

    function downArrow () {
        buttonState = "unLike";
        document.getElementById('button-image').src = "http://www.clker.com/cliparts/7/h/y/H/m/Y/red-thumbs-down-md.png";
    }

    function changedButtonLogic() {

        if (buttonState == "play"){
            window.location.href = getRefreshPage();

        }else{

        }
    }

    window.onload = function () {

        localStorage.setItem("userName", qs["userName"]);
        user = localStorage.getItem("userName");
        localStorage.setItem("valUser", user);

        document.getElementById('userId').value = user;
        document.getElementById('play').value = nextPlay;

    }
</script>

</body>
</html>



<btn onclick="displayBtn('like')"></btn>
<btn onclick="displayBtn('unlike')"></btn>

<!--var btnLike = 'like';-->
<!--function displayBtn(imgId) {-->
    <!--doc.getElemById('btn-like-unlike').src = 'style/' + imgId + '.png';-->
<!--btnLike = imgId;-->
<!--}-->